FROM yellowandorange/yoloxtb3:base

# ROS
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3-pip \
    ros-noetic-nav-msgs \
    ros-noetic-geometry-msgs \
    ros-noetic-dynamic-reconfigure \
 && rm -rf /var/lib/apt/lists/*

# Python
RUN pip3 install --no-cache-dir \
    numpy opencv-python-headless

# Launch Files
WORKDIR /root/ws/src
RUN mkdir -p tb3_motion
COPY ./tb3_motion /root/ws/src/tb3_motion

RUN find /root/ws/src/tb3_motion -type f -name "*.py" -exec chmod +x {} \; || true

# Catkin Make
WORKDIR /root/ws
RUN /bin/bash -lc "source root/ws/devel/setup.bash && catkin_make" \
    echo "source /root/ws/devel/setup.bash" >> /root/.bashrc


CMD ["bash", "-lc", "source root/ws/devel/setup.bash && source /opt/ros/noetic/setup.bash && roslaunch tb3_motion motion_core.launch"]
